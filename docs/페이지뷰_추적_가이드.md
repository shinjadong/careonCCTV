# 페이지뷰 추적 기능 가이드

## 개요
페이지에 접속하는 즉시 방문자의 모든 데이터를 자동으로 수집하여 Google Sheets에 저장하는 기능입니다.

## 수집되는 데이터 (15개 항목)

| 컬럼 | 항목 | 설명 | 예시 |
|------|------|------|------|
| A | timestamp | 접속 시간 | 2025-10-22 22:30:15 |
| B | current_url | 현재 페이지 URL | https://example.com/?utm_source=google |
| C | referrer | 이전 페이지 URL | https://google.com/search?q=cctv |
| D | landing_page | 최초 방문 페이지 | https://example.com/ |
| E | utm_source | 트래픽 소스 | google, naver, facebook |
| F | utm_medium | 매체 | cpc, social, email, organic |
| G | utm_campaign | 캠페인명 | cctv_summer_sale |
| H | utm_term | 검색 키워드 | cctv 설치 |
| I | utm_content | 광고 콘텐츠 | banner_a, text_ad |
| J | device_type | 디바이스 타입 | Mobile, Desktop, Tablet |
| K | screen_size | 화면 크기 | 1920x1080 |
| L | viewport_size | 뷰포트 크기 | 1920x937 |
| M | browser_language | 브라우저 언어 | ko-KR, en-US |
| N | is_touch_device | 터치 디바이스 여부 | Y, N |
| O | session_id | 세션 ID | session_1730304015123_abc123def |

## Google Sheets 설정

### 1. 새 시트 생성
Google Sheets에서 **"페이지뷰"** 라는 이름의 새 시트를 추가하세요.

### 2. 헤더 행 추가 (선택사항)
첫 번째 행에 다음 헤더를 추가하면 데이터를 더 쉽게 확인할 수 있습니다:

```
접속시간 | 현재URL | 이전페이지 | 랜딩페이지 | utm_source | utm_medium | utm_campaign | utm_term | utm_content | 디바이스 | 화면크기 | 뷰포트 | 언어 | 터치 | 세션ID
```

### 3. 환경변수 설정 (선택사항)
`.env.local` 파일에 다음을 추가할 수 있습니다:

```bash
# 페이지뷰 데이터 저장 위치
GOOGLE_SHEET_PAGEVIEW_RANGE=페이지뷰!A:O
```

기본값이 `페이지뷰!A:O`이므로 생략 가능합니다.

## 마케팅 분석 활용 예시

### 1. 트래픽 소스별 전환율 분석
```
utm_source로 그룹핑하여 어떤 채널이 가장 효과적인지 분석
- Google Ads: 150명 방문, 15명 전환 (10%)
- Facebook: 200명 방문, 10명 전환 (5%)
- Naver: 100명 방문, 20명 전환 (20%) ← 최고 효율
```

### 2. 디바이스별 사용자 행동 분석
```
device_type으로 모바일 vs 데스크톱 비교
- Mobile: 이탈률 높음 → 모바일 UX 개선 필요
- Desktop: 전환율 높음 → 데스크톱 광고 집중
```

### 3. 캠페인 효과 측정
```
utm_campaign으로 각 캠페인의 ROI 계산
- summer_sale: 500명 방문, 50명 전환, 광고비 100만원
- winter_event: 300명 방문, 40명 전환, 광고비 50만원 ← 더 효율적
```

### 4. 사용자 여정 추적
```
landing_page와 referrer를 조합하여 사용자 유입 경로 파악
- Google 검색 → 블로그 글 → 랜딩페이지 → 전환
```

## 주의사항

### 개인정보 보호
- 수집되는 데이터는 통계 및 마케팅 분석 목적입니다
- IP 주소나 개인 식별 정보는 수집하지 않습니다
- 개인정보 처리방침에 데이터 수집 내용을 명시하세요

### 세션 관리
- 세션 ID는 localStorage에 저장됩니다
- 30분 동안 활동이 없으면 새 세션이 생성됩니다
- 브라우저를 닫으면 세션이 유지됩니다 (쿠키와 다름)

### 성능 최적화
- 페이지 로드 후 100ms 후에 추적이 실행됩니다
- 추적 실패 시 사용자 경험에 영향 없음 (silent fail)
- React Strict Mode에서 중복 실행 방지됨

## 기술 구현

### 파일 구조
```
lib/
  ├── tracking.ts          # 데이터 수집 유틸리티
  └── google-sheets.ts     # Google Sheets 저장

app/
  └── actions/submit.ts    # trackPageView 서버 액션

components/
  └── PageViewTracker.tsx  # 자동 추적 컴포넌트

app/
  └── page.tsx            # PageViewTracker 사용
```

### 동작 흐름
1. 사용자가 페이지 접속
2. `PageViewTracker` 컴포넌트 마운트
3. `collectPageViewData()` 함수로 모든 데이터 수집
4. `trackPageView()` 서버 액션 호출
5. Google Sheets API를 통해 데이터 저장
6. 콘솔에 성공/실패 로그 출력

## 디버깅

### 브라우저 콘솔에서 확인
페이지 접속 후 콘솔에서 다음 메시지를 확인할 수 있습니다:

```
📊 페이지뷰 데이터 수집: {timestamp: "...", utm_source: "google", ...}
✅ 페이지뷰 추적 성공
```

또는 실패 시:
```
⚠️ 페이지뷰 추적 실패 (silent fail)
```

### Google Sheets 확인
"페이지뷰" 시트에 데이터가 실시간으로 추가되는지 확인하세요.

## FAQ

### Q: 같은 사용자가 여러 번 방문하면?
A: 세션 ID로 동일 사용자를 추적할 수 있습니다. 30분 내 재방문은 같은 세션으로 기록됩니다.

### Q: UTM 파라미터가 없으면?
A: 빈 문자열로 저장됩니다. 직접 접속이나 북마크 방문을 의미합니다.

### Q: 모바일 앱에서도 작동하나요?
A: 모바일 웹 브라우저에서는 작동하지만, 네이티브 앱에서는 작동하지 않습니다.

### Q: 광고 차단 프로그램의 영향은?
A: 일부 광고 차단 프로그램이 추적을 차단할 수 있습니다. 하지만 이는 외부 추적 스크립트가 아니라 자체 서버로 전송되므로 대부분 작동합니다.

## 라이선스 및 책임
이 기능은 마케팅 분석 목적으로 제공됩니다. 사용자는 관련 법규(개인정보보호법, GDPR 등)를 준수할 책임이 있습니다.
